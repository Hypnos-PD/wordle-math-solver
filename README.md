# Wordle 数学等式筛选器

一个纯前端的 Wordle 风格数学等式候选筛选工具，支持单式与 4 式并行模式。

## 功能特点

- ✅ 纯前端实现，零依赖，可离线使用
- ✅ 支持单式和 4 式并行模式
- ✅ 智能约束构建和 DFS 候选生成
- ✅ 颜色循环标记（灰→黄→绿，支持右键逆序）
- ✅ 约束一致性检查（防止添加矛盾的反馈）
- ✅ 猜测历史管理（删除最新、清空全部）
- ✅ 导入/导出状态（JSON 格式）
- ✅ 键盘输入、粘贴支持
- ✅ 可配置长度（5-20）、超时、最大结果数

## 快速开始

直接在浏览器中打开 `index.html` 即可使用，无需任何构建步骤。

```bash
# Windows
start index.html

# macOS
open index.html

# Linux
xdg-open index.html
```

## 使用说明

### 基本流程

1. **设置参数**：调整等式长度（默认 12）、最大结果数（默认 200）、超时时间（默认 2000ms）
2. **输入猜测**：在网格中输入等式字符（支持键盘输入或粘贴）
3. **标记颜色**：
   - 左键点击：灰 → 黄 → 绿 → 灰
   - 右键点击：绿 → 黄 → 灰 → 绿
4. **添加猜测**：点击"添加当前猜测"保存到历史（会自动检查约束一致性）
5. **管理历史**：可以删除最新猜测或清空全部历史
6. **搜索候选**：点击"开始搜索候选"生成可能的等式

### 颜色语义

- 🟩 **绿色**：字符在该位置正确
- 🟨 **黄色**：字符存在但位置错误
- ⬜ **灰色**：字符不存在，或出现次数已达上限

### 4 式模式

1. 勾选"4 式模式"复选框
2. 在主输入区输入字符
3. 在下方 4 行颜色格分别标记各目标的反馈
4. 添加猜测时会检查约束一致性
5. 搜索时会为每个目标独立生成候选
6. 猜测历史显示为两行（目标1+2，目标3+4）

### 等式规则

- 允许字符：`0-9 + - * / =`
- 必须恰好有一个 `=`，且不在首末
- 右侧只能是纯数字或负数（如 `-9`）
- 左右侧不能以 `*` 或 `/` 开头
- 等式两侧求值必须相等

## 示例

### 示例 1：单式模式 + 约束检查

假设目标等式是 `2+3-1*4=0`

1. 第一次猜测：`1+2-3*4=-5`
   - 标记颜色：根据反馈标记每个位置
   - 点击"添加当前猜测"
2. 第二次猜测：尝试输入矛盾的反馈
   - 系统会提示"约束冲突"并阻止添加
3. 输入正确的反馈后继续猜测
4. 搜索候选，查看可能的等式

### 示例 2：4 式模式 + 历史管理

当同一猜测对应 4 个不同目标时：

1. 在主输入输入：`2+-2+1-10=-9`
2. 在 4 行颜色格分别标记各自的反馈
3. 添加猜测（历史会分两行显示）
4. 如果发现标记错误，可点击"删除最新猜测"
5. 搜索时会为每个目标生成独立的候选列表

## 导入/导出

### 导出

点击"📤 导出状态"会：
- 将状态复制到剪贴板
- 自动下载 JSON 文件

### 导入

点击"📥 导入状态"，粘贴之前导出的 JSON 数据，即可恢复现场。

JSON 格式示例：
```json
{
  "version": 1,
  "length": 12,
  "mode4": false,
  "currentInput": "2+3-1*4=0",
  "currentStates": "xxggyyxxggxx",
  "colorGrids": null,
  "guesses": [
    {
      "guess": "1+2-3*4=-5",
      "patterns": "xygxxgxxxgyx",
      "is4Mode": false
    }
  ]
}
```

## 技术实现

### 文件结构

```
wordle-math-solver/
├── index.html      # 主页面
├── style.css       # 样式
├── solver.js       # 求解核心（约束构建、DFS、验证）
├── app.js          # UI 交互逻辑
└── README.md       # 本文档
```

### 核心算法

#### 约束对象

```javascript
{
  greens: Array(length),               // 固定字符或 null
  requiredCounts: {ch: n},             // ch 至少出现次数 (g+y)
  maxCounts: {ch: n},                  // 上限
  excluded: Set(),                     // 完全排除的字符
  yellowForbiddenPositions: {ch: Set(indices)} // 禁止位置
}
```

#### DFS 生成

- 按位置递归扩展
- 实时剪枝（次数限制、位置禁止、剩余可行性）
- 完成时验证等式合法性
- 按评分排序（鼓励字符多样性）

#### 评分公式

```javascript
score = uniqueChars * 1.5 - operatorCount
```

## 性能

- 默认 2 秒超时内返回 ≤200 条候选
- 支持实时取消搜索
- 针对大搜索空间有剪枝优化

## 兼容性

- 现代桌面浏览器（Chrome、Edge、Firefox、Safari）
- 需要支持 ES6+ 语法
- 无需服务器，完全客户端运行

## 开发

本项目遵循以下约定（详见 `.github/copilot-instructions.md`）：

- 纯前端，零依赖，无构建链
- UI 层与求解层分离
- 严格输入验证（防止注入）
- 导出 JSON 向后兼容

## 许可证

MIT License

## 作者

HypnosPD
